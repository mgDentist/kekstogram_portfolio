(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const ae=5;var M;const ue=(M=document.querySelector("#comment"))==null?void 0:M.content.querySelector(".social__comment"),q=document.querySelector(".social__comments"),u=document.querySelector(".social__comment-count"),h=document.querySelector(".comments-loader"),de=u==null?void 0:u.querySelector(".comments-count"),me=u==null?void 0:u.querySelector(".comments-rendered");let g=[];const pe=e=>{const t=ue.cloneNode(!0),o=t.querySelector(".social__picture");o.src=e.avatar,o.alt=e.name;const r=t.querySelector(".social__text");return r.textContent=e.message,t.appendChild(o),t.appendChild(r),t};h.addEventListener("click",()=>{const e=q.childElementCount;let t=e+ae;const o=t>=g.length;t=o?g.length:t;const r=g.slice(e,t),n=document.createDocumentFragment();me.textContent=t.toString(),h.hidden=o,r.forEach(c=>{n.appendChild(pe(c))}),q.appendChild(n),h.classList.toggle("hidden",o)});const ye=e=>{g=e,de.textContent=e.length.toString(),h.click()},fe=()=>{q.innerHTML="",g=[]},m=document.querySelector(".big-picture"),ge=m.querySelector(".big-picture__img img"),_e=m.querySelector(".likes-count"),Se=m.querySelector(".social__caption"),G=document.body,B=m.querySelector("#picture-cancel"),F=e=>{e.key==="Escape"&&R()},H=R;function R(){m.classList.add("hidden"),G.classList.remove("modal-open"),fe(),document.removeEventListener("keydown",F),B.removeEventListener("click",H)}const he=e=>{ge.src=e.url,_e.textContent=e.likes,Se.textContent=e.description,m.classList.remove("hidden"),G.classList.add("modal-open"),ye(e.comments),document.addEventListener("keydown",F),B.addEventListener("click",H)},x=document.querySelector(".pictures");var N;const ve=(N=document.querySelector("#picture"))==null?void 0:N.content.querySelector(".picture"),Ee=e=>{const t=ve.cloneNode(!0),o=t.querySelector(".picture__img"),r=t.querySelector(".picture__likes"),n=t.querySelector(".picture__comments"),{url:c,description:f,likes:se,comments:le}=e;return o.src=c,o.alt=f,r.textContent=se,n.textContent=le.length,t.addEventListener("click",ie=>{ie.preventDefault(),he(e)}),t},P=e=>{x.querySelectorAll(".picture").forEach(o=>o.remove());const t=document.createDocumentFragment();e.forEach(o=>{const r=Ee(o);t.appendChild(r)}),x.appendChild(t)},Le=5e3,qe=e=>{const t=document.createElement("div");t.style.position="absolute",t.style.zIndex="110",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout(()=>{t.remove()},Le)},be=(e,t=500)=>{let o;return(...r)=>{clearTimeout(o),o=setTimeout(()=>e.apply(globalThis,r),t)}},V=e=>e.key==="Escape",Te=e=>e.filter((o,r,n)=>n.indexOf(o)!==r).length<=0,Ce=document.querySelector(".scale__control--smaller"),ke=document.querySelector(".scale__control--bigger"),we=document.querySelector(".scale__control--value"),K=document.querySelector(".img-upload__preview img"),j=25;let s=100;const z=()=>{we.value=`${s}%`,K.style.transform=`scale(${s/100})`},Ae=()=>{s>=25&&s<100&&(s+=j,z())},De=()=>{s>25&&s<=100&&(s-=j,z())},xe=()=>{K.style.transform="scale(1)"};ke.addEventListener("click",()=>{Ae()});Ce.addEventListener("click",()=>{De()});const Pe=document.querySelector(".img-upload__form"),E=document.querySelector(".effect-level__slider"),l=document.querySelector(".effect-level__value"),W=document.querySelector(".img-upload__effect-level"),i=document.querySelector(".img-upload__preview img"),Oe=document.querySelector(".effects__list");noUiSlider.create(E,{range:{min:0,max:0},start:0,step:0,connect:"lower"});const a=(e=0,t=1,o=.1)=>{E.noUiSlider.updateOptions({range:{min:e,max:t},start:t,step:o})};let d="none";W.hidden=!0;const w=()=>{switch(W.hidden=d==="none",d){case"chrome":a();break;case"sepia":a();break;case"marvin":a(0,100,1);break;case"phobos":a(0,3,.1);break;case"heat":a(1,3,.1);break;default:a()}};Oe.addEventListener("change",e=>{d=e.target.value,w()});Pe.addEventListener("reset",()=>{d="none",w()});E.noUiSlider.on("update",()=>{switch(l.value=E.noUiSlider.get(),d){case"chrome":i.style.filter=`grayscale(${l.value})`;break;case"sepia":i.style.filter=`sepia(${l.value})`;break;case"marvin":i.style.filter=`invert(${l.value}%)`;break;case"phobos":i.style.filter=`blur(${l.value}px)`;break;case"heat":i.style.filter=`brightness(${l.value})`;break;default:i.style.filter=""}});const Ue=()=>{d="none",w()},Ie=/^#(?=.*[^0-9])[a-zа-яё0-9]{1,19}$/i,$e=5,O={IDLE:"Опубликовать",SUBMITTING:"Отправляю..."},_=document.querySelector(".img-upload__form"),S=_.querySelector('input[name="hashtags"]'),U=_.querySelector(".img-upload__submit");let L=[];const p=new Pristine(_,{classTo:"img-upload__field-wrapper",errorTextParent:"img-upload__field-wrapper",errorTextClass:"img-upload__field-wrapper--error"});S.addEventListener("blur",()=>{L=S.value.trim().toLowerCase().split(" ").filter(Boolean),p.validate()});const Me=()=>L.every(e=>Ie.test(e)),Ne=()=>L.length<=$e,Ge=()=>Te(L);p.addValidator(S,Me,"невалидный хэш-тег");p.addValidator(S,Ne,"не больше 5 хэш-тегов");p.addValidator(S,Ge,"хэш-теги не должны повторяться");const Be=()=>p.reset(),I=e=>{U.disabled=e,U.textContent=e?O.SUBMITTING:O.IDLE},Fe=e=>{_.addEventListener("submit",async t=>{t.preventDefault(),p.validate()&&(I(!0),await e(new FormData(_)),I())})},A=document.querySelector(".img-upload__form"),He=A.querySelector(".img-upload__input"),$=A.querySelector(".img-upload__preview img"),Re=A.querySelectorAll(".effects__preview"),Ve=["jpg","jpeg","png"],Ke=e=>{const t=e.name.toLowerCase();return Ve.some(o=>t.endsWith(o))},je=()=>{const e=He.files[0];e&&Ke(e)&&($.src=URL.createObjectURL(e),Re.forEach(t=>{t.style.backgroundImage=`url('${$.src}')`})),Y()},y=document.querySelector(".img-upload__form"),ze=y.querySelector(".img-upload__input"),We=y.querySelector('input[name="hashtags"]'),Xe=y.querySelector(".text__description"),X=y.querySelector(".img-upload__overlay"),Y=()=>{X.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",Q)},J=()=>y.reset();y.addEventListener("reset",()=>{xe(),Ue(),Be(),X.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",Q)});ze.addEventListener("change",()=>{Y(),je()});function Q(e){V(e)&&(e.preventDefault(),J())}[We,Xe].forEach(e=>{e.addEventListener("keydown",t=>{V(t)&&t.stopPropagation()})});const Ye="https://29.javascript.pages.academy/kekstagram",Z={GET_DATA:"/data",SEND_DATA:"/"},ee={GET:"GET",POST:"POST"},te={GET_DATA:"Не удалось загрузить данные. Попробуйте обновить страницу",SEND_DATA:"Не удалось отправить формую Попробуйте еще раз"},oe=(e,t,o=ee.GET,r=null)=>fetch(`${Ye}${e}`,{method:o,body:r}).then(n=>{if(!n.ok)throw new Error;return n.json()}).catch(()=>{throw new Error(t)}),Je=()=>oe(Z.GET_DATA,te.GET_DATA),Qe=e=>oe(Z.SEND_DATA,te.SEND_DATA,ee.POST,e),Ze=document.querySelector("#success").content.querySelector(".success"),et=document.querySelector("#error").content.querySelector(".error"),b=document.querySelector("body");function D(){(document.querySelector(".success")||document.querySelector(".error")).remove(),document.removeEventListener("keydown",re,!0),b.removeEventListener("click",ne)}function ne(e){e.target.closest(".success__inner")||e.target.closest(".error__inner")||D()}function re(e){e.key==="Escape"&&(e.stopPropagation(),D())}const ce=(e,t)=>{b.append(e),document.addEventListener("keydown",re,!0),b.addEventListener("click",ne),e.querySelector(t).addEventListener("click",D)},tt=()=>{ce(Ze,".success__button")},ot=()=>{ce(et,".error__button")},nt=10,T={DEFAULT:"filter-default",RANDOM:"filter-random",DISCUSSED:"filter-discussed"},C=document.querySelector(".img-filters");let k=T.DEFAULT,v=[];const rt=()=>Math.random()-.5,ct=(e,t)=>t.comments.length-e.comments.length,st=()=>{switch(k){case T.RANDOM:return[...v].sort(rt).slice(0,nt);case T.DISCUSSED:return[...v].sort(ct);default:return v}},lt=e=>{C.addEventListener("click",t=>{if(!t.target.classList.contains("img-filters__button"))return;const o=t.target;o.id!==k&&(C.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),o.classList.add("img-filters__button--active"),k=o.id,e(st()))})},it=(e,t)=>{C.classList.remove("img-filters--inactive"),v=[...e],lt(t)};Fe(async e=>{try{await Qe(e),J(),tt()}catch{ot()}});Je().then(e=>{P(e);const t=be(P);it(e,t)}).catch(e=>qe(e.message));
